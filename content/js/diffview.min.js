
diffview={buildView:function(params){var baseTextLines=params.baseTextLines,newTextLines=params.newTextLines,opcodes=params.opcodes,baseTextName=params.baseTextName?params.baseTextName:"Base Text",newTextName=params.newTextName?params.newTextName:"New Text",contextSize=params.contextSize,inline=(params.viewType==0||params.viewType==1)?params.viewType:0,inserted=0,deleted=0,changed=0,insertC=document.getElementById('insertCount'),deletedC=document.getElementById('deletedCount'),changedC=document.getElementById('changedCount');if(baseTextLines==null)
throw"Cannot build diff view; baseTextLines is not defined.";if(newTextLines==null)
throw"Cannot build diff view; newTextLines is not defined.";if(!opcodes)
throw"Canno build diff view; opcodes is not defined.";function celt(name,clazz){var e=document.createElement(name);e.className=clazz;return e;}
function telt(name,text){var e=document.createElement(name);e.appendChild(document.createTextNode(text));return e;}
function ctelt(name,clazz,text){var e=document.createElement(name);e.className=clazz;e.appendChild(document.createTextNode(text));return e;}
function btelt(name,clazz,text){var e=document.createElement(name);e.className=clazz;e.innerHTML=text;return e;}
var tdata=document.createElement("thead"),node=document.createElement("tr");tdata.appendChild(node);if(inline){node.appendChild(document.createElement("th"));node.appendChild(document.createElement("th"));node.appendChild(ctelt("th","texttitle",baseTextName+" vs. "+newTextName));}else{node.appendChild(document.createElement("th"));node.appendChild(ctelt("th","texttitle",newTextName));node.appendChild(document.createElement("th"));node.appendChild(ctelt("th","texttitle",baseTextName));}
tdata=[tdata];var rows=[],node2;function addCells(row,tidx,tend,textLines,change){if(tidx<tend){row.appendChild(telt("th",(tidx+1).toString()));row.appendChild(ctelt("td",change,textLines[tidx].replace(/\t/g,"\u00a0\u00a0\u00a0\u00a0")));return tidx+1;}else{row.appendChild(document.createElement("th"));row.appendChild(celt("td","empty"));return tidx;}}
function addCellsSpecial(row,tidx,tend,widx,wend,change,inlineDiff,last){if(tidx<tend){if(last){widx--;}
var output='';for(var e=0;e<inlineDiff.length;e++){var currDiff=inlineDiff[e];switch(currDiff[0]){case 0:output=output+currDiff[1];break;case 1:if(!last){output=output+'<span class="ins">'+currDiff[1]+'</span>';}
break;case-1:if(last){output=output+'<span class="dell">'+currDiff[1]+'</span>';}
break;}}
cleanText=output;row.appendChild(telt("th",(tidx+1).toString()));row.appendChild(btelt("td",change,cleanText));return tidx+1;}else{row.appendChild(document.createElement("th"));row.appendChild(celt("td","empty"));return tidx;}}
function addCellsInline(row,tidx,tidx2,textLines,change){row.appendChild(telt("th",tidx==null?"":(tidx+1).toString()));row.appendChild(telt("th",tidx2==null?"":(tidx2+1).toString()));row.appendChild(ctelt("td",change,textLines[tidx!=null?tidx:tidx2].replace(/\t/g,"\u00a0\u00a0\u00a0\u00a0")));}
for(var idx=0;idx<opcodes.length;idx++){code=opcodes[idx];change=code[0];var b=code[3],be=code[4],n=code[1],ne=code[2],rowcnt=Math.max(be-b,ne-n),toprows=[],botrows=[];for(var i=0;i<rowcnt;i++){if(contextSize&&opcodes.length>1&&((idx>0&&i==contextSize)||(idx==0&&i==0))&&change=="equal"){var jump=rowcnt-((idx==0?1:2)*contextSize);if(jump>1){toprows.push(node=document.createElement("tr"));b+=jump;n+=jump;i+=jump-1;node.appendChild(telt("th","..."));if(!inline)node.appendChild(ctelt("td","skip",""));node.appendChild(telt("th","..."));node.appendChild(ctelt("td","skip",""));if(idx+1==opcodes.length){break;}else{continue;}}}
toprows.push(node=document.createElement("tr"));if(inline){if(change=="insert"){addCellsInline(node,null,n++,newTextLines,change);}else if(change=="replace"){botrows.push(node2=document.createElement("tr"));if(b<be)addCellsInline(node,b++,null,baseTextLines,"delete");if(n<ne)addCellsInline(node2,null,n++,newTextLines,"insert");}else if(change=="delete"){addCellsInline(node,b++,null,baseTextLines,change);}else{addCellsInline(node,b++,n++,baseTextLines,change);}}else{switch(change){case'insert':inserted++;node.classList.add('difference');break;case'replace':if(b<be&&n<ne){changed++;}else{inserted++;}
node.classList.add('difference');break;case'delete':deleted++;node.classList.add('difference');break;}
if(change=="replace"){if(b<be&&n<ne){var cleanText=newTextLines[b].replace(/\t/g,"\u00a0\u00a0\u00a0\u00a0").replace(/</g,'&lt;').replace(/>/g,'&gt;');var diffText=baseTextLines[n].replace(/\t/g,"\u00a0\u00a0\u00a0\u00a0").replace(/</g,'&lt;').replace(/>/g,'&gt;');var inlineDiff=diff(diffText,cleanText,0);b=addCellsSpecial(node,b,be,n,ne,change,inlineDiff,false);n=addCellsSpecial(node,n,ne,b,be,change,inlineDiff,true);}else{b=addCells(node,b,be,newTextLines,"insert");n=addCells(node,n,ne,baseTextLines,change);}}else{b=addCells(node,b,be,newTextLines,change);n=addCells(node,n,ne,baseTextLines,change);}}}
for(var i=0;i<toprows.length;i++)rows.push(toprows[i]);for(var i=0;i<botrows.length;i++)rows.push(botrows[i]);}
insertC.innerHTML=inserted;changedC.innerHTML=changed;deletedC.innerHTML=deleted;tdata.push(node=document.createElement("tbody"));for(var idx in rows)rows.hasOwnProperty(idx)&&node.appendChild(rows[idx]);node=celt("table","diff"+(inline?" inlinediff":""));for(var idx in tdata)tdata.hasOwnProperty(idx)&&node.appendChild(tdata[idx]);return node;}};